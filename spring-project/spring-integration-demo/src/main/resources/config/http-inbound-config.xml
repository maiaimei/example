<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:int="http://www.springframework.org/schema/integration"
       xmlns:int-http="http://www.springframework.org/schema/integration/http"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="
    http://www.springframework.org/schema/beans
    https://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/util 
    http://www.springframework.org/schema/util/spring-util.xsd
    http://www.springframework.org/schema/integration
    https://www.springframework.org/schema/integration/spring-integration.xsd
    http://www.springframework.org/schema/integration/http
    https://www.springframework.org/schema/integration/http/spring-integration-http.xsd">
    
    <!-- 
    inbound-gateway: receives HTTP requests and produces responses
    inbound-channel-adapter: receives HTTP requests and doesn't produce responses
    -->

    <!-- createPerson start -->
    <!-- curl http://localhost:8080/persons -H "Content-Type: application/json" -d "{\"name\":\"Guest\"}" -->
    <int-http:inbound-gateway request-channel="createPersonRequestChannel"
                              supported-methods="POST"
                              path="/persons" 
                              extract-reply-payload="true" 
                              request-payload-type="cn.maiaimei.example.pojo.User">
        <int-http:request-mapping consumes="application/json" produces="application/json"/>
    </int-http:inbound-gateway>
    <int:service-activator input-channel="createPersonRequestChannel" ref="personService" method="create" />
    <!-- createPerson end -->
    
    <!-- getPerson start -->
    <!-- curl http://localhost:8080/persons/1 -->
    <int-http:inbound-gateway request-channel="getPersonRequestChannel" 
                              supported-methods="GET"
                              path="/persons/{id}" 
                              payload-expression="#pathVariables.id">
        <int-http:request-mapping produces="application/json"/>
    </int-http:inbound-gateway>
    <int:service-activator input-channel="getPersonRequestChannel" ref="personService" method="get" />
    <!-- getPerson end -->

    <!-- deletePerson start -->
    <!-- curl -X DELETE http://localhost:8080/persons/1 -->
    <int-http:inbound-channel-adapter id="deletePerson" channel="deletePersonChannel" 
                                      supported-methods="DELETE" 
                                      path="/persons/{id}" 
                                      payload-expression="#pathVariables.id" />
    <int:service-activator input-channel="deletePersonChannel" ref="personService" method="delete" />
    <!-- deletePerson end -->
    
    <bean id="personService" class="cn.maiaimei.example.service.PersonService" />

</beans>
